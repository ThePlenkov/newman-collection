include:
  - project: theplenkov-npm/npm-cicd
    file: /typescript/.gitlab-ci.yml

stages:
  - test:node
  - test:cli
  - deploy

test:collection:build:
  stage: test:node
  extends: .ts
  script:
    - npm run test:collection
  artifacts:
    untracked: false
    expire_in: 30 days
    paths:
      - test/results

test:collection:run:
  image: postman/newman
  stage: test:cli
  script:
    - run test/results/postman-echo.collection.json
  needs:
    - test:collection:build

test:newman:
  extends: .ts
  stage: test:node
  script:
    - npm run test:newman
